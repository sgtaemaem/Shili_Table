# UPJI视力测试系统开机自启动说明

## 🚀 安装开机自启动

### 方法1: 运行安装脚本（推荐）

```bash
cd /home/cat/桌面/shilibiao/upji
chmod +x install_autostart_main.sh
./install_autostart_main.sh
```

### 方法2: 手动安装

1. **创建systemd用户服务目录**：
```bash
mkdir -p ~/.config/systemd/user
```

2. **复制服务文件**：
```bash
cp upji-vision-test.service ~/.config/systemd/user/
```

3. **启用服务**：
```bash
systemctl --user daemon-reload
systemctl --user enable upji-vision-test.service
```

## 📋 服务管理命令

### 基本操作
- **查看服务状态**: `systemctl --user status upji-vision-test`
- **启动服务**: `systemctl --user start upji-vision-test`
- **停止服务**: `systemctl --user stop upji-vision-test`
- **重启服务**: `systemctl --user restart upji-vision-test`
- **禁用开机自启动**: `systemctl --user disable upji-vision-test`

### 日志查看
- **查看实时日志**: `journalctl --user -u upji-vision-test -f`
- **查看最近日志**: `journalctl --user -u upji-vision-test -n 50`
- **查看错误日志**: `journalctl --user -u upji-vision-test --priority=err`

## 🔧 配置说明

### 服务配置文件位置
- **用户服务**: `~/.config/systemd/user/upji-vision-test.service`
- **桌面自启动**: `~/.config/autostart/upji-vision-test.desktop`

### 环境变量
- `DISPLAY=:0` - 显示环境
- `XDG_RUNTIME_DIR` - 运行时目录
- `PULSE_RUNTIME_PATH` - 音频系统路径

## 🎯 测试方法

### 1. 手动测试
```bash
# 启动服务
systemctl --user start upji-vision-test

# 查看状态
systemctl --user status upji-vision-test

# 查看日志
journalctl --user -u upji-vision-test -f
```

### 2. 开机测试
1. 重启电脑
2. 登录到桌面环境
3. 检查程序是否自动启动
4. 如有问题，查看日志进行调试

## ⚠️ 注意事项

### 系统要求
- 需要登录到桌面环境（图形界面）
- 需要摄像头和麦克风权限
- 需要网络连接（语音识别功能）

### 常见问题

#### 1. 服务启动失败
- 检查Python3是否正确安装
- 检查程序路径是否正确
- 查看错误日志：`journalctl --user -u upji-vision-test --priority=err`

#### 2. 摄像头无法访问
- 确保摄像头设备可用
- 检查摄像头权限设置
- 确保没有其他程序占用摄像头

#### 3. 语音识别不工作
- 检查麦克风设备
- 确保网络连接正常
- 检查语音识别配置

#### 4. 程序界面不显示
- 确保已登录到桌面环境
- 检查DISPLAY环境变量设置
- 尝试手动启动程序测试

## 🛠️ 故障排除

### 查看详细日志
```bash
# 查看服务详细状态
systemctl --user status upji-vision-test -l

# 查看最近的错误
journalctl --user -u upji-vision-test --since "1 hour ago" --priority=err

# 查看完整日志
journalctl --user -u upji-vision-test --no-pager
```

### 重新安装服务
```bash
# 停止并禁用服务
systemctl --user stop upji-vision-test
systemctl --user disable upji-vision-test

# 删除服务文件
rm ~/.config/systemd/user/upji-vision-test.service

# 重新运行安装脚本
./install_autostart_main.sh
```

### 手动启动测试
```bash
# 直接运行程序测试
cd /home/cat/桌面/shilibiao/upji
python3 main.py
```

## 📞 技术支持

如果遇到问题，请：
1. 查看日志文件
2. 检查系统环境
3. 尝试手动启动程序
4. 记录错误信息

---

**安装完成后，系统将在每次开机登录后自动启动UPJI视力测试系统！**
